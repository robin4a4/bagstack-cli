"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var R=require("path"),G=require("fs");function q(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var d=q(R),O=q(G);function T(r){const t=/^\\\\\?\\/.test(r),n=/[^\u0000-\u0080]+/.test(r);return t||n?r:r.replace(/\\/g,"/")}function F(r,t){for(;;){const n=d.default.join(r,t);if(O.default.existsSync(n))return T(n);const e=d.default.dirname(r);if(e===r)return;r=e}}function K(r,t){t===void 0&&(t=!1);var n=r.length,e=0,s="",a=0,o=16,u=0,c=0,p=0,C=0,f=0;function A(i,b){for(var v=0,k=0;v<i||!b;){var h=r.charCodeAt(e);if(h>=48&&h<=57)k=k*16+h-48;else if(h>=65&&h<=70)k=k*16+h-65+10;else if(h>=97&&h<=102)k=k*16+h-97+10;else break;e++,v++}return v<i&&(k=-1),k}function V(i){e=i,s="",a=0,o=16,f=0}function $(){var i=e;if(r.charCodeAt(e)===48)e++;else for(e++;e<r.length&&y(r.charCodeAt(e));)e++;if(e<r.length&&r.charCodeAt(e)===46)if(e++,e<r.length&&y(r.charCodeAt(e)))for(e++;e<r.length&&y(r.charCodeAt(e));)e++;else return f=3,r.substring(i,e);var b=e;if(e<r.length&&(r.charCodeAt(e)===69||r.charCodeAt(e)===101))if(e++,(e<r.length&&r.charCodeAt(e)===43||r.charCodeAt(e)===45)&&e++,e<r.length&&y(r.charCodeAt(e))){for(e++;e<r.length&&y(r.charCodeAt(e));)e++;b=e}else f=3;return r.substring(i,b)}function E(){for(var i="",b=e;;){if(e>=n){i+=r.substring(b,e),f=2;break}var v=r.charCodeAt(e);if(v===34){i+=r.substring(b,e),e++;break}if(v===92){if(i+=r.substring(b,e),e++,e>=n){f=2;break}var k=r.charCodeAt(e++);switch(k){case 34:i+='"';break;case 92:i+="\\";break;case 47:i+="/";break;case 98:i+="\b";break;case 102:i+="\f";break;case 110:i+=`
`;break;case 114:i+="\r";break;case 116:i+="	";break;case 117:var h=A(4,!0);h>=0?i+=String.fromCharCode(h):f=4;break;default:f=5}b=e;continue}if(v>=0&&v<=31)if(S(v)){i+=r.substring(b,e),f=2;break}else f=6;e++}return i}function P(){if(s="",f=0,a=e,c=u,C=p,e>=n)return a=n,o=17;var i=r.charCodeAt(e);if(U(i)){do e++,s+=String.fromCharCode(i),i=r.charCodeAt(e);while(U(i));return o=15}if(S(i))return e++,s+=String.fromCharCode(i),i===13&&r.charCodeAt(e)===10&&(e++,s+=`
`),u++,p=e,o=14;switch(i){case 123:return e++,o=1;case 125:return e++,o=2;case 91:return e++,o=3;case 93:return e++,o=4;case 58:return e++,o=6;case 44:return e++,o=5;case 34:return e++,s=E(),o=10;case 47:var b=e-1;if(r.charCodeAt(e+1)===47){for(e+=2;e<n&&!S(r.charCodeAt(e));)e++;return s=r.substring(b,e),o=12}if(r.charCodeAt(e+1)===42){e+=2;for(var v=n-1,k=!1;e<v;){var h=r.charCodeAt(e);if(h===42&&r.charCodeAt(e+1)===47){e+=2,k=!0;break}e++,S(h)&&(h===13&&r.charCodeAt(e)===10&&e++,u++,p=e)}return k||(e++,f=1),s=r.substring(b,e),o=13}return s+=String.fromCharCode(i),e++,o=16;case 45:if(s+=String.fromCharCode(i),e++,e===n||!y(r.charCodeAt(e)))return o=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return s+=$(),o=11;default:for(;e<n&&m(i);)e++,i=r.charCodeAt(e);if(a!==e){switch(s=r.substring(a,e),s){case"true":return o=8;case"false":return o=9;case"null":return o=7}return o=16}return s+=String.fromCharCode(i),e++,o=16}}function m(i){if(U(i)||S(i))return!1;switch(i){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function l(){var i;do i=P();while(i>=12&&i<=15);return i}return{setPosition:V,getPosition:function(){return e},scan:t?l:P,getToken:function(){return o},getTokenValue:function(){return s},getTokenOffset:function(){return a},getTokenLength:function(){return e-a},getTokenStartLine:function(){return c},getTokenStartCharacter:function(){return a-C},getTokenError:function(){return f}}}function U(r){return r===32||r===9||r===11||r===12||r===160||r===5760||r>=8192&&r<=8203||r===8239||r===8287||r===12288||r===65279}function S(r){return r===10||r===13||r===8232||r===8233}function y(r){return r>=48&&r<=57}var D;(function(r){r.DEFAULT={allowTrailingComma:!1}})(D||(D={}));function Q(r,t,n){t===void 0&&(t=[]),n===void 0&&(n=D.DEFAULT);var e=null,s=[],a=[];function o(c){Array.isArray(s)?s.push(c):e!==null&&(s[e]=c)}var u={onObjectBegin:function(){var c={};o(c),a.push(s),s=c,e=null},onObjectProperty:function(c){e=c},onObjectEnd:function(){s=a.pop()},onArrayBegin:function(){var c=[];o(c),a.push(s),s=c,e=null},onArrayEnd:function(){s=a.pop()},onLiteralValue:o,onError:function(c,p,C){t.push({error:c,offset:p,length:C})}};return X(r,u,n),s[0]}function X(r,t,n){n===void 0&&(n=D.DEFAULT);var e=K(r,!1);function s(g){return g?function(){return g(e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}function a(g){return g?function(w){return g(w,e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}var o=s(t.onObjectBegin),u=a(t.onObjectProperty),c=s(t.onObjectEnd),p=s(t.onArrayBegin),C=s(t.onArrayEnd),f=a(t.onLiteralValue),A=a(t.onSeparator),V=s(t.onComment),$=a(t.onError),E=n&&n.disallowComments,P=n&&n.allowTrailingComma;function m(){for(;;){var g=e.scan();switch(e.getTokenError()){case 4:l(14);break;case 5:l(15);break;case 3:l(13);break;case 1:E||l(11);break;case 2:l(12);break;case 6:l(16);break}switch(g){case 12:case 13:E?l(10):V();break;case 16:l(1);break;case 15:case 14:break;default:return g}}}function l(g,w,_){if(w===void 0&&(w=[]),_===void 0&&(_=[]),$(g),w.length+_.length>0)for(var L=e.getToken();L!==17;){if(w.indexOf(L)!==-1){m();break}else if(_.indexOf(L)!==-1)break;L=m()}}function i(g){var w=e.getTokenValue();return g?f(w):u(w),m(),!0}function b(){switch(e.getToken()){case 11:var g=e.getTokenValue(),w=Number(g);isNaN(w)&&(l(2),w=0),f(w);break;case 7:f(null);break;case 8:f(!0);break;case 9:f(!1);break;default:return!1}return m(),!0}function v(){return e.getToken()!==10?(l(3,[],[2,5]),!1):(i(!1),e.getToken()===6?(A(":"),m(),B()||l(4,[],[2,5])):l(5,[],[2,5]),!0)}function k(){o(),m();for(var g=!1;e.getToken()!==2&&e.getToken()!==17;){if(e.getToken()===5){if(g||l(4,[],[]),A(","),m(),e.getToken()===2&&P)break}else g&&l(6,[],[]);v()||l(4,[],[2,5]),g=!0}return c(),e.getToken()!==2?l(7,[2],[]):m(),!0}function h(){p(),m();for(var g=!1;e.getToken()!==4&&e.getToken()!==17;){if(e.getToken()===5){if(g||l(4,[],[]),A(","),m(),e.getToken()===4&&P)break}else g&&l(6,[],[]);B()||l(4,[],[4,5]),g=!0}return C(),e.getToken()!==4?l(8,[4],[]):m(),!0}function B(){switch(e.getToken()){case 3:return h();case 1:return k();case 10:return i(!0);default:return b()}}return m(),e.getToken()===17?n.allowEmptyContent?!0:(l(4,[],[]),!1):B()?(e.getToken()!==17&&l(9,[],[]),!0):(l(4,[],[]),!1)}var Y=Q;const W=/^\.{1,2}(\/.*)?$/,M=r=>T(W.test(r)?r:`./${r}`),N=r=>O.default.existsSync(r),Z=r=>{try{return JSON.parse(r)}catch{}};function x(r,t){let n=r;if(n===".."&&(n+="/tsconfig.json"),n.startsWith(".")){let e=d.default.resolve(t,n);if(N(e)&&O.default.statSync(e).isFile()||!e.endsWith(".json")&&(e+=".json",N(e)))return e}else{let e=F(t,d.default.join("node_modules",n));if(e){if(O.default.statSync(e).isDirectory()){const s=d.default.join(e,"package.json");if(N(s)){const a=Z(O.default.readFileSync(s,"utf8"));a&&"tsconfig"in a?e=d.default.join(e,a.tsconfig):e=d.default.join(e,"tsconfig.json")}else e=d.default.join(e,"tsconfig.json");if(N(e))return e}else if(e.endsWith(".json"))return e}if(!n.endsWith(".json")&&(n+=".json",e=F(t,d.default.join("node_modules",n)),e))return e}throw new Error(`File '${r}' not found.`)}var ee=Object.defineProperty,re=Object.defineProperties,ne=Object.getOwnPropertyDescriptors,I=Object.getOwnPropertySymbols,te=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable,z=(r,t,n)=>t in r?ee(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,j=(r,t)=>{for(var n in t||(t={}))te.call(t,n)&&z(r,n,t[n]);if(I)for(var n of I(t))ae.call(t,n)&&z(r,n,t[n]);return r},oe=(r,t)=>re(r,ne(t));function J(r){var t;let n;try{n=O.default.realpathSync(r)}catch{throw new Error(`Cannot resolve tsconfig at path: ${r}`)}const e=d.default.dirname(n),s=O.default.readFileSync(n,"utf8").trim();let a={};if(s&&(a=Y(s),!a||typeof a!="object"))throw new SyntaxError(`Failed to parse tsconfig at: ${r}`);if(a.extends){const o=x(a.extends,e),u=J(o);if(delete u.references,(t=u.compilerOptions)!=null&&t.baseUrl){const{compilerOptions:p}=u;p.baseUrl=d.default.relative(e,d.default.join(d.default.dirname(o),p.baseUrl))||"./"}u.files&&(u.files=u.files.map(p=>d.default.relative(e,d.default.join(d.default.dirname(o),p)))),u.include&&(u.include=u.include.map(p=>d.default.relative(e,d.default.join(d.default.dirname(o),p)))),delete a.extends;const c=oe(j(j({},u),a),{compilerOptions:j(j({},u.compilerOptions),a.compilerOptions)});u.watchOptions&&(c.watchOptions=j(j({},u.watchOptions),a.watchOptions)),a=c}if(a.compilerOptions){const{compilerOptions:o}=a;o.baseUrl&&(o.baseUrl=M(o.baseUrl)),o.outDir&&(Array.isArray(a.exclude)||(a.exclude=[]),a.exclude.push(o.outDir),o.outDir=M(o.outDir))}if(a.files&&(a.files=a.files.map(M)),a.include&&(a.include=a.include.map(T)),a.watchOptions){const{watchOptions:o}=a;o.excludeDirectories&&(o.excludeDirectories=o.excludeDirectories.map(u=>T(d.default.resolve(e,u))))}return a}function ie(r=process.cwd(),t="tsconfig.json"){const n=F(r,t);if(!n)return null;const e=J(n);return{path:n,config:e}}const se=/\*/g,H=(r,t)=>{const n=r.match(se);if(n&&n.length>1)throw new Error(t)};function fe(r){if(r.includes("*")){const[t,n]=r.split("*");return{prefix:t,suffix:n}}return r}const ue=({prefix:r,suffix:t},n)=>n.startsWith(r)&&n.endsWith(t);function ce(r,t,n){return Object.entries(r).map(([e,s])=>(H(e,`Pattern '${e}' can have at most one '*' character.`),{pattern:fe(e),substitutions:s.map(a=>{if(H(a,`Substitution '${a}' in pattern '${e}' can have at most one '*' character.`),!t&&!W.test(a))throw new Error("Non-relative paths are not allowed when 'baseUrl' is not set. Did you forget a leading './'?");return d.default.join(n,a)})}))}function le(r){if(!r.config.compilerOptions)return null;const{baseUrl:t,paths:n}=r.config.compilerOptions;if(!t&&!n)return null;const e=d.default.resolve(d.default.dirname(r.path),t||"."),s=n?ce(n,t,e):[];return function(o){if(W.test(o))return[];const u=[];for(const f of s){if(f.pattern===o)return f.substitutions.map(T);typeof f.pattern!="string"&&u.push(f)}let c,p=-1;for(const f of u)ue(f.pattern,o)&&f.pattern.prefix.length>p&&(p=f.pattern.prefix.length,c=f);if(!c)return t?[T(d.default.join(e,o))]:[];const C=o.slice(c.pattern.prefix.length,o.length-c.pattern.suffix.length);return c.substitutions.map(f=>T(f.replace("*",C)))}}exports.createPathsMatcher=le,exports.getTsconfig=ie,exports.parseTsconfig=J;
