import g from"path";import O from"fs";function T(r){const t=/^\\\\\?\\/.test(r),n=/[^\u0000-\u0080]+/.test(r);return t||n?r:r.replace(/\\/g,"/")}function F(r,t){for(;;){const n=g.join(r,t);if(O.existsSync(n))return T(n);const e=g.dirname(r);if(e===r)return;r=e}}function R(r,t){t===void 0&&(t=!1);var n=r.length,e=0,s="",a=0,o=16,f=0,u=0,p=0,C=0,c=0;function A(i,b){for(var v=0,m=0;v<i||!b;){var h=r.charCodeAt(e);if(h>=48&&h<=57)m=m*16+h-48;else if(h>=65&&h<=70)m=m*16+h-65+10;else if(h>=97&&h<=102)m=m*16+h-97+10;else break;e++,v++}return v<i&&(m=-1),m}function V(i){e=i,s="",a=0,o=16,c=0}function $(){var i=e;if(r.charCodeAt(e)===48)e++;else for(e++;e<r.length&&y(r.charCodeAt(e));)e++;if(e<r.length&&r.charCodeAt(e)===46)if(e++,e<r.length&&y(r.charCodeAt(e)))for(e++;e<r.length&&y(r.charCodeAt(e));)e++;else return c=3,r.substring(i,e);var b=e;if(e<r.length&&(r.charCodeAt(e)===69||r.charCodeAt(e)===101))if(e++,(e<r.length&&r.charCodeAt(e)===43||r.charCodeAt(e)===45)&&e++,e<r.length&&y(r.charCodeAt(e))){for(e++;e<r.length&&y(r.charCodeAt(e));)e++;b=e}else c=3;return r.substring(i,b)}function E(){for(var i="",b=e;;){if(e>=n){i+=r.substring(b,e),c=2;break}var v=r.charCodeAt(e);if(v===34){i+=r.substring(b,e),e++;break}if(v===92){if(i+=r.substring(b,e),e++,e>=n){c=2;break}var m=r.charCodeAt(e++);switch(m){case 34:i+='"';break;case 92:i+="\\";break;case 47:i+="/";break;case 98:i+="\b";break;case 102:i+="\f";break;case 110:i+=`
`;break;case 114:i+="\r";break;case 116:i+="	";break;case 117:var h=A(4,!0);h>=0?i+=String.fromCharCode(h):c=4;break;default:c=5}b=e;continue}if(v>=0&&v<=31)if(S(v)){i+=r.substring(b,e),c=2;break}else c=6;e++}return i}function P(){if(s="",c=0,a=e,u=f,C=p,e>=n)return a=n,o=17;var i=r.charCodeAt(e);if(U(i)){do e++,s+=String.fromCharCode(i),i=r.charCodeAt(e);while(U(i));return o=15}if(S(i))return e++,s+=String.fromCharCode(i),i===13&&r.charCodeAt(e)===10&&(e++,s+=`
`),f++,p=e,o=14;switch(i){case 123:return e++,o=1;case 125:return e++,o=2;case 91:return e++,o=3;case 93:return e++,o=4;case 58:return e++,o=6;case 44:return e++,o=5;case 34:return e++,s=E(),o=10;case 47:var b=e-1;if(r.charCodeAt(e+1)===47){for(e+=2;e<n&&!S(r.charCodeAt(e));)e++;return s=r.substring(b,e),o=12}if(r.charCodeAt(e+1)===42){e+=2;for(var v=n-1,m=!1;e<v;){var h=r.charCodeAt(e);if(h===42&&r.charCodeAt(e+1)===47){e+=2,m=!0;break}e++,S(h)&&(h===13&&r.charCodeAt(e)===10&&e++,f++,p=e)}return m||(e++,c=1),s=r.substring(b,e),o=13}return s+=String.fromCharCode(i),e++,o=16;case 45:if(s+=String.fromCharCode(i),e++,e===n||!y(r.charCodeAt(e)))return o=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return s+=$(),o=11;default:for(;e<n&&k(i);)e++,i=r.charCodeAt(e);if(a!==e){switch(s=r.substring(a,e),s){case"true":return o=8;case"false":return o=9;case"null":return o=7}return o=16}return s+=String.fromCharCode(i),e++,o=16}}function k(i){if(U(i)||S(i))return!1;switch(i){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function l(){var i;do i=P();while(i>=12&&i<=15);return i}return{setPosition:V,getPosition:function(){return e},scan:t?l:P,getToken:function(){return o},getTokenValue:function(){return s},getTokenOffset:function(){return a},getTokenLength:function(){return e-a},getTokenStartLine:function(){return u},getTokenStartCharacter:function(){return a-C},getTokenError:function(){return c}}}function U(r){return r===32||r===9||r===11||r===12||r===160||r===5760||r>=8192&&r<=8203||r===8239||r===8287||r===12288||r===65279}function S(r){return r===10||r===13||r===8232||r===8233}function y(r){return r>=48&&r<=57}var D;(function(r){r.DEFAULT={allowTrailingComma:!1}})(D||(D={}));function q(r,t,n){t===void 0&&(t=[]),n===void 0&&(n=D.DEFAULT);var e=null,s=[],a=[];function o(u){Array.isArray(s)?s.push(u):e!==null&&(s[e]=u)}var f={onObjectBegin:function(){var u={};o(u),a.push(s),s=u,e=null},onObjectProperty:function(u){e=u},onObjectEnd:function(){s=a.pop()},onArrayBegin:function(){var u=[];o(u),a.push(s),s=u,e=null},onArrayEnd:function(){s=a.pop()},onLiteralValue:o,onError:function(u,p,C){t.push({error:u,offset:p,length:C})}};return G(r,f,n),s[0]}function G(r,t,n){n===void 0&&(n=D.DEFAULT);var e=R(r,!1);function s(d){return d?function(){return d(e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}function a(d){return d?function(w){return d(w,e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}var o=s(t.onObjectBegin),f=a(t.onObjectProperty),u=s(t.onObjectEnd),p=s(t.onArrayBegin),C=s(t.onArrayEnd),c=a(t.onLiteralValue),A=a(t.onSeparator),V=s(t.onComment),$=a(t.onError),E=n&&n.disallowComments,P=n&&n.allowTrailingComma;function k(){for(;;){var d=e.scan();switch(e.getTokenError()){case 4:l(14);break;case 5:l(15);break;case 3:l(13);break;case 1:E||l(11);break;case 2:l(12);break;case 6:l(16);break}switch(d){case 12:case 13:E?l(10):V();break;case 16:l(1);break;case 15:case 14:break;default:return d}}}function l(d,w,_){if(w===void 0&&(w=[]),_===void 0&&(_=[]),$(d),w.length+_.length>0)for(var L=e.getToken();L!==17;){if(w.indexOf(L)!==-1){k();break}else if(_.indexOf(L)!==-1)break;L=k()}}function i(d){var w=e.getTokenValue();return d?c(w):f(w),k(),!0}function b(){switch(e.getToken()){case 11:var d=e.getTokenValue(),w=Number(d);isNaN(w)&&(l(2),w=0),c(w);break;case 7:c(null);break;case 8:c(!0);break;case 9:c(!1);break;default:return!1}return k(),!0}function v(){return e.getToken()!==10?(l(3,[],[2,5]),!1):(i(!1),e.getToken()===6?(A(":"),k(),B()||l(4,[],[2,5])):l(5,[],[2,5]),!0)}function m(){o(),k();for(var d=!1;e.getToken()!==2&&e.getToken()!==17;){if(e.getToken()===5){if(d||l(4,[],[]),A(","),k(),e.getToken()===2&&P)break}else d&&l(6,[],[]);v()||l(4,[],[2,5]),d=!0}return u(),e.getToken()!==2?l(7,[2],[]):k(),!0}function h(){p(),k();for(var d=!1;e.getToken()!==4&&e.getToken()!==17;){if(e.getToken()===5){if(d||l(4,[],[]),A(","),k(),e.getToken()===4&&P)break}else d&&l(6,[],[]);B()||l(4,[],[4,5]),d=!0}return C(),e.getToken()!==4?l(8,[4],[]):k(),!0}function B(){switch(e.getToken()){case 3:return h();case 1:return m();case 10:return i(!0);default:return b()}}return k(),e.getToken()===17?n.allowEmptyContent?!0:(l(4,[],[]),!1):B()?(e.getToken()!==17&&l(9,[],[]),!0):(l(4,[],[]),!1)}var K=q;const W=/^\.{1,2}(\/.*)?$/,J=r=>T(W.test(r)?r:`./${r}`),N=r=>O.existsSync(r),Q=r=>{try{return JSON.parse(r)}catch{}};function X(r,t){let n=r;if(n===".."&&(n+="/tsconfig.json"),n.startsWith(".")){let e=g.resolve(t,n);if(N(e)&&O.statSync(e).isFile()||!e.endsWith(".json")&&(e+=".json",N(e)))return e}else{let e=F(t,g.join("node_modules",n));if(e){if(O.statSync(e).isDirectory()){const s=g.join(e,"package.json");if(N(s)){const a=Q(O.readFileSync(s,"utf8"));a&&"tsconfig"in a?e=g.join(e,a.tsconfig):e=g.join(e,"tsconfig.json")}else e=g.join(e,"tsconfig.json");if(N(e))return e}else if(e.endsWith(".json"))return e}if(!n.endsWith(".json")&&(n+=".json",e=F(t,g.join("node_modules",n)),e))return e}throw new Error(`File '${r}' not found.`)}var Y=Object.defineProperty,Z=Object.defineProperties,x=Object.getOwnPropertyDescriptors,I=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable,z=(r,t,n)=>t in r?Y(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,j=(r,t)=>{for(var n in t||(t={}))ee.call(t,n)&&z(r,n,t[n]);if(I)for(var n of I(t))re.call(t,n)&&z(r,n,t[n]);return r},ne=(r,t)=>Z(r,x(t));function M(r){var t;let n;try{n=O.realpathSync(r)}catch{throw new Error(`Cannot resolve tsconfig at path: ${r}`)}const e=g.dirname(n),s=O.readFileSync(n,"utf8").trim();let a={};if(s&&(a=K(s),!a||typeof a!="object"))throw new SyntaxError(`Failed to parse tsconfig at: ${r}`);if(a.extends){const o=X(a.extends,e),f=M(o);if(delete f.references,(t=f.compilerOptions)!=null&&t.baseUrl){const{compilerOptions:p}=f;p.baseUrl=g.relative(e,g.join(g.dirname(o),p.baseUrl))||"./"}f.files&&(f.files=f.files.map(p=>g.relative(e,g.join(g.dirname(o),p)))),f.include&&(f.include=f.include.map(p=>g.relative(e,g.join(g.dirname(o),p)))),delete a.extends;const u=ne(j(j({},f),a),{compilerOptions:j(j({},f.compilerOptions),a.compilerOptions)});f.watchOptions&&(u.watchOptions=j(j({},f.watchOptions),a.watchOptions)),a=u}if(a.compilerOptions){const{compilerOptions:o}=a;o.baseUrl&&(o.baseUrl=J(o.baseUrl)),o.outDir&&(Array.isArray(a.exclude)||(a.exclude=[]),a.exclude.push(o.outDir),o.outDir=J(o.outDir))}if(a.files&&(a.files=a.files.map(J)),a.include&&(a.include=a.include.map(T)),a.watchOptions){const{watchOptions:o}=a;o.excludeDirectories&&(o.excludeDirectories=o.excludeDirectories.map(f=>T(g.resolve(e,f))))}return a}function te(r=process.cwd(),t="tsconfig.json"){const n=F(r,t);if(!n)return null;const e=M(n);return{path:n,config:e}}const ae=/\*/g,H=(r,t)=>{const n=r.match(ae);if(n&&n.length>1)throw new Error(t)};function oe(r){if(r.includes("*")){const[t,n]=r.split("*");return{prefix:t,suffix:n}}return r}const ie=({prefix:r,suffix:t},n)=>n.startsWith(r)&&n.endsWith(t);function se(r,t,n){return Object.entries(r).map(([e,s])=>(H(e,`Pattern '${e}' can have at most one '*' character.`),{pattern:oe(e),substitutions:s.map(a=>{if(H(a,`Substitution '${a}' in pattern '${e}' can have at most one '*' character.`),!t&&!W.test(a))throw new Error("Non-relative paths are not allowed when 'baseUrl' is not set. Did you forget a leading './'?");return g.join(n,a)})}))}function ce(r){if(!r.config.compilerOptions)return null;const{baseUrl:t,paths:n}=r.config.compilerOptions;if(!t&&!n)return null;const e=g.resolve(g.dirname(r.path),t||"."),s=n?se(n,t,e):[];return function(o){if(W.test(o))return[];const f=[];for(const c of s){if(c.pattern===o)return c.substitutions.map(T);typeof c.pattern!="string"&&f.push(c)}let u,p=-1;for(const c of f)ie(c.pattern,o)&&c.pattern.prefix.length>p&&(p=c.pattern.prefix.length,u=c);if(!u)return t?[T(g.join(e,o))]:[];const C=o.slice(u.pattern.prefix.length,o.length-u.pattern.suffix.length);return u.substitutions.map(c=>T(c.replace("*",C)))}}export{ce as createPathsMatcher,te as getTsconfig,M as parseTsconfig};
